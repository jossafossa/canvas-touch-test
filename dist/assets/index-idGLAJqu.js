(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();class h extends Event{constructor(t,e){super(t),this.pointers=[];let i=e.type??"drag";["drag","dragstart","dragend"].includes(i)&&this.drag(e),["pointermove","pointerdown","pointerup"].includes(i)&&this.pointerMove(e),["touchmove","touchstart","touchend"].includes(i)&&this.touchMove(e)}drag(t){this.pointers=t.pointers}pointerMove(t){this.pointers.push({id:t.pointerId,x:t.clientX,y:t.clientY,size:10})}touchMove(t){for(let e=0;e<t.touches.length;e++){let i=t.touches[e];console.log(i),this.pointers.push({id:i.identifier,x:i.clientX,y:i.clientY,size:i.force*20})}}}class M extends EventTarget{constructor(t){super(),this.root=t,this.root.addEventListener("touchmove",e=>{this.dispatchEvent(new h("drag",e))}),this.root.addEventListener("touchend",e=>{this.dispatchEvent(new h("dragend",e))}),this.root.addEventListener("touchstart",e=>{this.dispatchEvent(new h("dragstart",e))})}}class P extends EventTarget{constructor(t){super(),this.root=t,this.isDragging=!1,this.root.addEventListener("pointermove",e=>{this.isDragging&&this.dispatchEvent(new h("drag",e))}),this.root.addEventListener("pointerdown",e=>{this.isDragging=!0,this.dispatchEvent(new h("dragstart",e))}),this.root.addEventListener("pointerup",e=>{this.dispatchEvent(new h("dragend",{pointers:[]})),this.isDragging=!1})}}class z{constructor(t){this.size=t,this.buffer=new Array(t).fill(0),this.index=0,this.count=0,this.sum=0}smooth(t){return this.sum-=this.buffer[this.index],this.buffer[this.index]=t,this.sum+=t,this.index=(this.index+1)%this.size,this.count=Math.min(this.count+1,this.size),this.sum/this.count}}class w{constructor(t,e=["x","y"]){this.buffers=new Map,this.size=t,this.attributes=e,this.previous=null;for(let i of e)this.buffers.set(i,new z(t))}smooth(t,e=!0){const i={...t};for(let s of this.attributes)i[s]=this.buffers.get(s).smooth(t[s]);if(e&&this.previous){let s=0;for(let r of this.attributes)s+=Math.pow(i[r]-this.previous[r],2);i.speed=Math.sqrt(s)}else i.speed=0;return this.previous={...i},i}}class S extends EventTarget{constructor(t,e={}){super(),this.settings={smooth:30,...e},this.buffers=new Map,this.event=new h("drag",{pointers:[]}),this.pointers=[],this.buffer=new w(this.settings.smooth),this.root=t,this.touchListener=new M(this.root),this.mouseListener=new P(this.root);let i=this.isTouch()?this.touchListener:this.mouseListener;i.addEventListener("dragstart",s=>{this.event=s,this.dispatchEvent(new h("dragstart",s))}),i.addEventListener("drag",s=>{this.event=s}),i.addEventListener("dragend",()=>{this.buffers.clear(),this.event=new h("dragend",{pointers:[]}),this.dispatchEvent(this.event)}),this.loop()}isTouch(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}loop(){var i;let t=((i=this.event)==null?void 0:i.pointers)??[],e=[];for(let s of t){let r=this.buffers.get(s.id);r||(r=new w(this.settings.smooth,["x","y","size"]),this.buffers.set(s.id,r));let n=r.smooth(s);e.push(n)}this.dispatchEvent(new h("drag",{pointers:e})),window.requestAnimationFrame(()=>{this.loop()})}}const T=o=>{o=Object.fromEntries(o.entries());for(let t in o){let e=document.querySelector(`[name="${t}"]`);console.log({key:t,input:e}),e&&(e.value=o[t])}};let d=document.querySelector("#root"),u=window.devicePixelRatio??1;d.width=window.innerWidth*u;d.height=window.innerHeight*u;d.style.height=window.innerHeight+"px";d.style.width=window.innerWidth+"px";let v=new URLSearchParams(window.location.search);T(v);let f=v.get("smoothing")??5,g=v.get("dots")??2;g=parseInt(g);f=parseInt(f);let E=new S(d,{smooth:f});const a=d.getContext("2d"),q=(o,t=1)=>{let e=[`rgba( 255, 0, 0, ${t} )`,`rgba( 0, 255, 0, ${t} )`,`rgba( 0, 0, 255, ${t} )`,`rgba( 255, 255, 0, ${t} )`,`rgba( 0, 255, 255, ${t} )`,`rgba( 255, 0, 255, ${t} )`];o=o.toString();let i=0;for(let s=0;s<o.length;s++)i+=o.charCodeAt(s);return i=i%e.length,e[i]};let b=0,p=new Map;E.addEventListener("dragend",o=>{console.log("dragend"),p=new Map,b++});const O=(o,t,e=10)=>{let i=[],s=t.x-o.x,r=t.y-o.y,n=Math.sqrt(s**2+r**2),m=Math.atan2(r,s),c=Math.round(n/e);console.log({steps:c});for(let l=0;l<c;l++){let x=o.x+Math.cos(m)*l*e,y=o.y+Math.sin(m)*l*e,L=o.size+(t.size-o.size)*(l/c);i.push({x,y,size:L})}return i},$=o=>{let t=o.pointers??[];for(let e of t){d.setPointerCapture(e.id);let i=q(e.id+b);a.fillStyle=i,console.log(e.size,e.speed);let s=p.get(e.id),r=[e];s&&(r=O(s,e,g));for(let n of r)a.beginPath(),a.arc(n.x*u,n.y*u,n.size*u,0,Math.PI*2),a.fill(),a.closePath();p.set(e.id,e)}};["drag","dragstart"].forEach(o=>E.addEventListener(o,$));const A=document.querySelectorAll("output");for(let o of A){let t=document.querySelector("#"+o.htmlFor),e=o.getAttribute("suffix")??"";o.value=t.value+e,t.addEventListener("input",()=>{o.value=t.value+e})}
