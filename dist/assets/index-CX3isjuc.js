(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();class d extends Event{constructor(t,e){super(t),this.pointers=[];let s=e.type??"drag";s==="drag"&&this.drag(e),s==="pointermove"&&this.pointerMove(e),s==="touchmove"&&this.touchMove(e)}drag(t){this.pointers=t.pointers}pointerMove(t){this.pointers.push({id:t.pointerId,x:t.clientX,y:t.clientY,size:10})}touchMove(t){for(let e=0;e<t.touches.length;e++){let s=t.touches[e];console.log(s),this.pointers.push({id:s.identifier,x:s.clientX,y:s.clientY,size:(s.radiusX+s.radiusY)*s.force/2})}}}class p extends EventTarget{constructor(t){super(),this.root=t,this.root.addEventListener("touchmove",e=>{this.dispatchEvent(new d("drag",e))}),this.root.addEventListener("touchend",e=>{this.dispatchEvent(new d("dragend",e))})}}class m extends EventTarget{constructor(t){super(),this.root=t,this.isDragging=!1,this.root.addEventListener("pointerdown",e=>{this.isDragging=!0}),this.root.addEventListener("pointerup",e=>{this.dispatchEvent(new d("dragend",{pointers:[]})),this.isDragging=!1}),this.root.addEventListener("pointermove",e=>{this.isDragging&&this.dispatchEvent(new d("drag",e))})}}class v{constructor(t){this.buffer=[],this.size=t}smooth(t){return this.buffer.push(t),this.buffer.length>this.size&&this.buffer.shift(),this.buffer.reduce((s,i)=>s+i)/this.buffer.length}}class c{constructor(t,e=["x","y"]){this.buffers=new Map,this.size=t,this.attributes=e;for(let s of e)this.buffers.set(s,new v(t))}smooth(t){const e={...t};for(let s of this.attributes)e[s]=this.buffers.get(s).smooth(t[s]);return console.log({copy:e,all:t,attribute:this.attributes,buffers:this.buffers}),e}}class b extends EventTarget{constructor(t,e={}){super(),this.settings={smooth:30,...e},this.buffers=new Map,this.event=new d("drag",{pointers:[]}),this.pointers=[],this.buffer=new c(this.settings.smooth),this.root=t,this.touchListener=new p(this.root),this.mouseListener=new m(this.root),[this.mouseListener,this.touchListener].forEach(s=>{s.addEventListener("drag",i=>{this.event=i}),s.addEventListener("dragend",()=>{this.buffers.clear(),this.event=new d("dragend",{pointers:[]}),this.dispatchEvent(this.event)})}),this.loop()}loop(){var s;let t=((s=this.event)==null?void 0:s.pointers)??[],e=[];for(let i of t){let r=this.buffers.get(i.id);r||(r=new c(this.settings.smooth,["x","y","size"]),this.buffers.set(i.id,r));let u=r.smooth(i);e.push(u)}this.dispatchEvent(new d("drag",{pointers:e})),window.requestAnimationFrame(()=>{this.loop()})}}let f=document.querySelector("#root"),h=window.devicePixelRatio??1;f.width=window.innerWidth*h;f.height=window.innerHeight*h;let a=new b(f,{smooth:10});const n=f.getContext("2d"),w=(o,t=1)=>{let e=[`rgba( 255, 0, 0, ${t} )`,`rgba( 0, 255, 0, ${t} )`,`rgba( 0, 0, 255, ${t} )`,`rgba( 255, 255, 0, ${t} )`,`rgba( 0, 255, 255, ${t} )`,`rgba( 255, 0, 255, ${t} )`];o=o.toString();let s=0;for(let i=0;i<o.length;i++)s+=o.charCodeAt(i);return s=s%e.length,e[s]};let g=0,l=new Map;a.addEventListener("dragend",o=>{console.log("dragend"),l=new Map,g++});a.addEventListener("drag",o=>{let t=o.pointers??[];for(let e of t){let s=w(e.id+g);n.fillStyle=s,n.beginPath(),n.arc(e.x*h,e.y*h,e.size*h,0,Math.PI*2),n.fill(),n.closePath();let i=l.get(e.id);i&&(n.strokeStyle=s,n.lineWidth=e.size*2*h,n.beginPath(),n.moveTo(i.x*h,i.y*h),n.lineTo(e.x*h,e.y*h),n.stroke(),n.closePath()),l.set(e.id,e)}});
